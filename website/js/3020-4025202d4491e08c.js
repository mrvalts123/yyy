(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3020],{16563:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});var r=t(23877),i=t(65055),a=t(33219);function o(e){(0,a.Z)(1,arguments);var n=(0,i.Z)(e);return(0,r.Z)(1e3*n)}},83401:function(e,n,t){var r=t(24253),i=t(72251),a=t(63792),o=Math.ceil,u=Math.max;e.exports=function(e,n,t){n=(t?i(e,n,t):void 0===n)?1:u(a(n),0);var c=null==e?0:e.length;if(!c||n<1)return[];for(var s=0,m=0,l=Array(o(c/n));s<c;)l[m++]=r(e,s,s+=n);return l}},46962:function(e,n,t){"use strict";t.d(n,{xO:function(){return O},vN:function(){return E},zy:function(){return B},Gt:function(){return F}});var r=t(52100),i=t(75105);const a=new i.PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"),o=new i.PublicKey("TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb"),u=new i.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"),c=new i.PublicKey("So11111111111111111111111111111111111111112");new i.PublicKey("9pan9bMn5HatX4EJdBwg9VgCa7Uz5HL8N1m5D3NdXejP");var s=t(52466),m=t(78200);class l extends Error{constructor(e){super(e)}}class p extends l{constructor(){super(...arguments),this.name="TokenOwnerOffCurveError"}}t(795).Buffer;const d=(0,s.struct)([(0,s.u32)("mintAuthorityOption"),(0,m.ZL)("mintAuthority"),(0,m.AW)("supply"),(0,s.u8)("decimals"),(0,m.Xg)("isInitialized"),(0,s.u32)("freezeAuthorityOption"),(0,m.ZL)("freezeAuthority")]);d.span;function y(e,n,t=!1,r=a,o=u){if(!t&&!i.PublicKey.isOnCurve(n.toBuffer()))throw new p;const[c]=i.PublicKey.findProgramAddressSync([n.toBuffer(),r.toBuffer(),e.toBuffer()],o);return c}var f=t(795).Buffer;function g(e,n,t,r,i=a,o=u){return h(e,n,t,r,f.alloc(0),i,o)}function h(e,n,t,r,o,c=a,s=u){const m=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1}];return new i.TransactionInstruction({keys:m,programId:s,data:o})}var A,P=t(27196),k=t(42754);t(795).Buffer;!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initialized=1]="Initialized",e[e.Frozen=2]="Frozen"}(A||(A={}));const b=(0,s.struct)([(0,m.ZL)("mint"),(0,m.ZL)("owner"),(0,m.AW)("amount"),(0,s.u32)("delegateOption"),(0,m.ZL)("delegate"),(0,s.u8)("state"),(0,s.u32)("isNativeOption"),(0,m.AW)("isNative"),(0,m.AW)("delegatedAmount"),(0,s.u32)("closeAuthorityOption"),(0,m.ZL)("closeAuthority")]);b.span;var M=t(83401),S=t(795).Buffer,K=(e,n,t)=>new Promise(((r,i)=>{var a=e=>{try{u(t.next(e))}catch(n){i(n)}},o=e=>{try{u(t.throw(e))}catch(n){i(n)}},u=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);u((t=t.apply(e,n)).next())})),w=new i.PublicKey("REFER4ZgmyYx9c6He5XfaTMiGfdLwRnkV4RPp9t9iF3"),v={version:"0.1.0",name:"referral",instructions:[{name:"initializeProject",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"base",isMut:!1,isSigner:!0},{name:"admin",isMut:!1,isSigner:!1},{name:"project",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"params",type:{defined:"InitializeProjectParams"}}]},{name:"initializeReferralAccount",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"partner",isMut:!1,isSigner:!1},{name:"project",isMut:!1,isSigner:!1},{name:"referralAccount",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"params",type:{defined:"InitializeReferralAccountParams"}}]},{name:"initializeReferralAccountWithName",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"partner",isMut:!1,isSigner:!1},{name:"project",isMut:!1,isSigner:!1},{name:"referralAccount",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"params",type:{defined:"InitializeReferralAccountWithNameParams"}}]},{name:"updateProject",accounts:[{name:"admin",isMut:!1,isSigner:!0},{name:"project",isMut:!0,isSigner:!1}],args:[{name:"params",type:{defined:"UpdateProjectParams"}}]},{name:"transferProject",accounts:[{name:"admin",isMut:!1,isSigner:!0},{name:"newAdmin",isMut:!1,isSigner:!1},{name:"project",isMut:!0,isSigner:!1}],args:[{name:"params",type:{defined:"TransferProjectParams"}}]},{name:"updateReferralAccount",accounts:[{name:"admin",isMut:!1,isSigner:!0},{name:"project",isMut:!1,isSigner:!1},{name:"referralAccount",isMut:!0,isSigner:!1}],args:[{name:"params",type:{defined:"UpdateReferralAccountParams"}}]},{name:"transferReferralAccount",accounts:[{name:"partner",isMut:!1,isSigner:!0},{name:"newPartner",isMut:!1,isSigner:!1},{name:"referralAccount",isMut:!0,isSigner:!1}],args:[{name:"params",type:{defined:"TransferReferralAccountParams"}}]},{name:"initializeReferralTokenAccount",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"project",isMut:!1,isSigner:!1},{name:"referralAccount",isMut:!1,isSigner:!1},{name:"referralTokenAccount",isMut:!0,isSigner:!1},{name:"mint",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1}],args:[]},{name:"claim",accounts:[{name:"payer",isMut:!0,isSigner:!0},{name:"project",isMut:!1,isSigner:!1},{name:"admin",isMut:!1,isSigner:!1},{name:"projectAdminTokenAccount",isMut:!0,isSigner:!1},{name:"referralAccount",isMut:!1,isSigner:!1},{name:"referralTokenAccount",isMut:!0,isSigner:!1},{name:"partner",isMut:!1,isSigner:!1},{name:"partnerTokenAccount",isMut:!0,isSigner:!1},{name:"mint",isMut:!1,isSigner:!1},{name:"associatedTokenProgram",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1}],args:[]},{name:"createAdminTokenAccount",accounts:[{name:"project",isMut:!1,isSigner:!1},{name:"projectAuthority",isMut:!0,isSigner:!1},{name:"admin",isMut:!1,isSigner:!1},{name:"projectAdminTokenAccount",isMut:!0,isSigner:!1},{name:"mint",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"associatedTokenProgram",isMut:!1,isSigner:!1}],args:[]},{name:"withdrawFromProject",accounts:[{name:"admin",isMut:!0,isSigner:!0},{name:"project",isMut:!1,isSigner:!1},{name:"projectAuthority",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"params",type:{defined:"WithdrawFromProjectParams"}}]}],accounts:[{name:"project",type:{kind:"struct",fields:[{name:"base",type:"publicKey"},{name:"admin",type:"publicKey"},{name:"name",type:"string"},{name:"defaultShareBps",type:"u16"}]}},{name:"referralAccount",type:{kind:"struct",fields:[{name:"partner",type:"publicKey"},{name:"project",type:"publicKey"},{name:"shareBps",type:"u16"},{name:"name",type:{option:"string"}}]}}],types:[{name:"InitializeProjectParams",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"defaultShareBps",type:"u16"}]}},{name:"InitializeReferralAccountWithNameParams",type:{kind:"struct",fields:[{name:"name",type:"string"}]}},{name:"InitializeReferralAccountParams",type:{kind:"struct",fields:[]}},{name:"TransferProjectParams",type:{kind:"struct",fields:[]}},{name:"TransferReferralAccountParams",type:{kind:"struct",fields:[]}},{name:"UpdateProjectParams",type:{kind:"struct",fields:[{name:"name",type:{option:"string"}},{name:"defaultShareBps",type:{option:"u16"}}]}},{name:"UpdateReferralAccountParams",type:{kind:"struct",fields:[{name:"shareBps",type:"u16"}]}},{name:"WithdrawFromProjectParams",type:{kind:"struct",fields:[{name:"amount",type:"u64"}]}}],events:[{name:"InitializeProjectEvent",fields:[{name:"project",type:"publicKey",index:!1},{name:"admin",type:"publicKey",index:!1},{name:"name",type:"string",index:!1},{name:"defaultShareBps",type:"u16",index:!1}]},{name:"UpdateProjectEvent",fields:[{name:"project",type:"publicKey",index:!1},{name:"name",type:"string",index:!1},{name:"defaultShareBps",type:"u16",index:!1}]},{name:"InitializeReferralAccountEvent",fields:[{name:"project",type:"publicKey",index:!1},{name:"partner",type:"publicKey",index:!1},{name:"referralAccount",type:"publicKey",index:!1},{name:"shareBps",type:"u16",index:!1},{name:"name",type:{option:"string"},index:!1}]},{name:"UpdateReferralAccountEvent",fields:[{name:"referralAccount",type:"publicKey",index:!1},{name:"shareBps",type:"u16",index:!1}]},{name:"InitializeReferralTokenAccountEvent",fields:[{name:"project",type:"publicKey",index:!1},{name:"referralAccount",type:"publicKey",index:!1},{name:"referralTokenAccount",type:"publicKey",index:!1},{name:"mint",type:"publicKey",index:!1}]},{name:"ClaimEvent",fields:[{name:"project",type:"publicKey",index:!1},{name:"projectAdminTokenAccount",type:"publicKey",index:!1},{name:"referralAccount",type:"publicKey",index:!1},{name:"referralTokenAccount",type:"publicKey",index:!1},{name:"partnerTokenAccount",type:"publicKey",index:!1},{name:"mint",type:"publicKey",index:!1},{name:"referralAmount",type:"u64",index:!1},{name:"projectAmount",type:"u64",index:!1}]}],errors:[{code:6e3,name:"InvalidCalculation"},{code:6001,name:"InvalidSharePercentage"},{code:6002,name:"NameTooLong"}]},j=(e,n,t,...r)=>K(void 0,[e,n,t,...r],(function*(e,n,t,r=n,i=!0,o=a){let u;try{u=y(e,n,i,o);if(!(yield t.getAccountInfo(u))){return[u,g(r,u,n,e,o)]}return[u,void 0]}catch(c){throw console.error("Error::getOrCreateATAInstruction",c),c}})),T=class{constructor(e){this.connection=e;const n=new r.Y7(e,{},r.Y7.defaultOptions());this.program=new r.$r(v,w,n)}getProjects(){return K(this,arguments,(function*(e=[]){return yield this.program.account.project.all(e)}))}getProject(e){return K(this,null,(function*(){return yield this.program.account.project.fetch(e)}))}getReferralAccount(e){return K(this,null,(function*(){return yield this.program.account.referralAccount.fetch(e)}))}getReferralAccounts(){return K(this,arguments,(function*(e=[]){return yield this.program.account.referralAccount.all(e)}))}getProjectAuthorityPubKey(e){let[n]=i.PublicKey.findProgramAddressSync([S.from("project_authority"),e.base.toBuffer()],this.program.programId);return n}getReferralAccountWithNamePubKey({projectPubKey:e,name:n}){const[t]=i.PublicKey.findProgramAddressSync([S.from("referral"),e.toBuffer(),S.from(n)],this.program.programId);return t}getReferralTokenAccountPubKey({referralAccountPubKey:e,mint:n}){const[t]=i.PublicKey.findProgramAddressSync([S.from("referral_ata"),e.toBuffer(),n.toBuffer()],this.program.programId);return t}getReferralTokenAccounts(e){return K(this,null,(function*(){const n=yield this.program.account.referralAccount.fetch(new i.PublicKey(e)),[t,r]=yield Promise.all([a,o].map((t=>K(this,null,(function*(){const r=new Set,a=new Set,o=new Map;return(yield this.connection.getTokenAccountsByOwner(n.project,{programId:t})).value.map((n=>{const t=b.decode(n.account.data);if(!r.has(t.mint.toBase58())){const n=this.getReferralTokenAccountPubKey({referralAccountPubKey:new i.PublicKey(e),mint:t.mint});r.add(t.mint.toBase58()),a.add(n.toBase58())}o.set(n.pubkey.toBase58(),t)})),Array.from(a).reduce(((e,n)=>{const t=o.get(n);return t&&e.push({pubkey:new i.PublicKey(n),account:t}),e}),[])})))));return{tokenAccounts:t,token2022Accounts:r}}))}initializeProject(e){return K(this,arguments,(function*({basePubKey:e,adminPubKey:n,name:t,defaultShareBps:r}){const[a]=i.PublicKey.findProgramAddressSync([S.from("project"),e.toBuffer()],this.program.programId);return yield this.program.methods.initializeProject({name:t,defaultShareBps:r}).accounts({admin:n,project:a,base:e}).transaction()}))}transferProject(e){return K(this,arguments,(function*({newAdminPubKey:e,projectPubKey:n}){const t=yield this.program.account.project.fetch(n);return yield this.program.methods.transferProject({}).accounts({admin:t.admin,project:n,newAdmin:e}).transaction()}))}initializeReferralAccount(e){return K(this,arguments,(function*({projectPubKey:e,partnerPubKey:n,payerPubKey:t,referralAccountPubKey:r}){return yield this.program.methods.initializeReferralAccount({}).accounts({project:e,partner:n,referralAccount:r,payer:t}).transaction()}))}initializeReferralAccountWithName(e){return K(this,arguments,(function*({projectPubKey:e,partnerPubKey:n,payerPubKey:t,name:r}){const i=this.getReferralAccountWithNamePubKey({projectPubKey:e,name:r});return{tx:yield this.program.methods.initializeReferralAccountWithName({name:r}).accounts({project:e,partner:n,referralAccount:i,payer:t}).transaction(),referralAccountPubKey:i}}))}transferReferralAccount(e){return K(this,arguments,(function*({newPartnerPubKey:e,referralAccountPubKey:n}){const t=yield this.program.account.referralAccount.fetch(n);return yield this.program.methods.transferReferralAccount({}).accounts({partner:t.partner,newPartner:e,referralAccount:n}).transaction()}))}initializeReferralTokenAccount(e){return K(this,arguments,(function*({payerPubKey:e,referralAccountPubKey:n,mint:t}){const r=yield this.connection.getAccountInfo(t);if(!r)throw new Error("Invalid mint");if(![a,o].some((e=>e.equals(r.owner))))throw new Error("Invalid mint");const i=yield this.program.account.referralAccount.fetch(n),u=this.getReferralTokenAccountPubKey({referralAccountPubKey:n,mint:t});return{tx:yield this.program.methods.initializeReferralTokenAccount().accounts({payer:e,project:i.project,referralAccount:n,referralTokenAccount:u,mint:t,tokenProgram:r.owner}).transaction(),referralTokenAccountPubKey:u}}))}claim(e){return K(this,arguments,(function*({payerPubKey:e,referralAccountPubKey:n,mint:t}){const r=yield this.connection.getAccountInfo(t);if(!r)throw new Error("Invalid mint");if(![a,o].some((e=>e.equals(r.owner))))throw new Error("Invalid mint");const i=yield this.program.account.referralAccount.fetch(n),u=yield this.program.account.project.fetch(i.project),[c,[s,m],[l,p]]=yield Promise.all([this.getReferralTokenAccountPubKey({referralAccountPubKey:n,mint:t}),j(t,i.partner,this.connection,e,void 0,r.owner),j(t,u.admin,this.connection,e,void 0,r.owner)]);let d=[];if(m&&d.push(m),p){const e=this.getProjectAuthorityPubKey(u),n=yield this.program.methods.createAdminTokenAccount().accounts({project:i.project,projectAuthority:e,admin:u.admin,projectAdminTokenAccount:l,mint:t,tokenProgram:r.owner}).instruction();d.push(n)}return yield this.program.methods.claim().accounts({payer:e,project:i.project,admin:u.admin,projectAdminTokenAccount:l,referralAccount:n,referralTokenAccount:c,partner:i.partner,partnerTokenAccount:s,mint:t,tokenProgram:r.owner}).preInstructions(d).transaction()}))}claimAll(e){return K(this,arguments,(function*({payerPubKey:e,referralAccountPubKey:n}){const t=(yield this.connection.getLatestBlockhash()).blockhash,r=yield this.connection.getAddressLookupTable(new i.PublicKey("GBzQG2iFrPwXjGtCnwNt9S5eHd8xAR8jUMt3QDJpnjud")).then((e=>e.value)),u=yield this.program.account.referralAccount.fetch(n),c=yield this.program.account.project.fetch(u.project),s=this.getProjectAuthorityPubKey(c),{tokenAccounts:m,token2022Accounts:l}=yield this.getReferralTokenAccounts(n.toString());return(yield Promise.all([m,l].map(((m,l)=>K(this,null,(function*(){const p=0===l?a:o,d=m.filter((e=>e.account.amount>0)),f=yield this.connection.getParsedTokenAccountsByOwner(u.partner,{programId:p}),h=yield this.connection.getParsedTokenAccountsByOwner(c.admin,{programId:p}),A=yield Promise.all(d.map((t=>K(this,null,(function*(){var r,i;let a=null==(r=f.value.find((e=>t.account.mint.toBase58()===e.account.data.parsed.info.mint)))?void 0:r.pubkey,o=null==(i=h.value.find((e=>t.account.mint.toBase58()===e.account.data.parsed.info.mint)))?void 0:i.pubkey;const m=this.getReferralTokenAccountPubKey({referralAccountPubKey:n,mint:t.account.mint}),l=[];if(a||(a=y(t.account.mint,u.partner,!0,p),l.push(g(e,a,u.partner,t.account.mint,p))),!o){o=y(t.account.mint,c.admin,!0,p);const e=yield this.program.methods.createAdminTokenAccount().accounts({project:u.project,projectAuthority:s,admin:c.admin,projectAdminTokenAccount:o,mint:t.account.mint,tokenProgram:p}).instruction();l.push(e)}return{referralTokenAccountPubKey:m,projectAdminTokenAccount:o,partnerTokenAccount:a,preInstructions:l,mint:t.account.mint}}))))),P=M(A,5);return Promise.all(P.map((a=>K(this,null,(function*(){const o=yield Promise.all(a.map((t=>K(this,[t],(function*({preInstructions:t,mint:r,projectAdminTokenAccount:i,referralTokenAccountPubKey:a,partnerTokenAccount:o}){return yield this.program.methods.claim().accounts({payer:e,project:u.project,admin:c.admin,projectAdminTokenAccount:i,referralAccount:n,referralTokenAccount:a,partner:u.partner,partnerTokenAccount:o,mint:r,tokenProgram:p}).preInstructions(t).transaction()}))))),s=new i.TransactionMessage({payerKey:e,instructions:o.flatMap((e=>e.instructions)),recentBlockhash:t}).compileToV0Message([r]);return new i.VersionedTransaction(s)})))))})))))).flat()}))}},x=t(795).Buffer,I=(e,n,t)=>new Promise(((r,i)=>{var a=e=>{try{u(t.next(e))}catch(n){i(n)}},o=e=>{try{u(t.throw(e))}catch(n){i(n)}},u=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);u((t=t.apply(e,n)).next())})),O={version:"0.1.0",name:"limit_order",instructions:[{name:"initializeOrder",accounts:[{name:"base",isMut:!1,isSigner:!0},{name:"maker",isMut:!0,isSigner:!0},{name:"order",isMut:!0,isSigner:!1},{name:"reserve",isMut:!0,isSigner:!1,docs:["CHECK"]},{name:"makerInputAccount",isMut:!0,isSigner:!1},{name:"inputMint",isMut:!1,isSigner:!1},{name:"makerOutputAccount",isMut:!1,isSigner:!1},{name:"referral",isMut:!1,isSigner:!1,isOptional:!0},{name:"outputMint",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"rent",isMut:!1,isSigner:!1}],args:[{name:"makingAmount",type:"u64"},{name:"takingAmount",type:"u64"},{name:"expiredAt",type:{option:"i64"}}]},{name:"fillOrder",accounts:[{name:"order",isMut:!0,isSigner:!1},{name:"reserve",isMut:!0,isSigner:!1},{name:"maker",isMut:!0,isSigner:!1},{name:"taker",isMut:!1,isSigner:!0},{name:"takerOutputAccount",isMut:!0,isSigner:!1},{name:"makerOutputAccount",isMut:!0,isSigner:!1},{name:"takerInputAccount",isMut:!0,isSigner:!1},{name:"feeAuthority",isMut:!1,isSigner:!1},{name:"programFeeAccount",isMut:!0,isSigner:!1},{name:"referral",isMut:!0,isSigner:!1,isOptional:!0},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"makingAmount",type:"u64"},{name:"maxTakingAmount",type:"u64"}]},{name:"preFlashFillOrder",accounts:[{name:"order",isMut:!0,isSigner:!1},{name:"reserve",isMut:!0,isSigner:!1},{name:"taker",isMut:!1,isSigner:!0},{name:"takerOutputAccount",isMut:!0,isSigner:!1},{name:"inputMint",isMut:!1,isSigner:!1},{name:"inputMintTokenProgram",isMut:!1,isSigner:!1},{name:"instruction",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"makingAmount",type:"u64"}]},{name:"flashFillOrder",accounts:[{name:"order",isMut:!0,isSigner:!1},{name:"reserve",isMut:!0,isSigner:!1},{name:"maker",isMut:!0,isSigner:!1},{name:"taker",isMut:!1,isSigner:!0},{name:"makerOutputAccount",isMut:!0,isSigner:!1},{name:"takerInputAccount",isMut:!0,isSigner:!1},{name:"feeAuthority",isMut:!1,isSigner:!1},{name:"programFeeAccount",isMut:!0,isSigner:!1},{name:"referral",isMut:!0,isSigner:!1,isOptional:!0},{name:"inputMint",isMut:!1,isSigner:!1},{name:"inputMintTokenProgram",isMut:!1,isSigner:!1},{name:"outputMint",isMut:!1,isSigner:!1},{name:"outputMintTokenProgram",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"maxTakingAmount",type:"u64"}]},{name:"cancelOrder",accounts:[{name:"order",isMut:!0,isSigner:!1},{name:"reserve",isMut:!0,isSigner:!1,docs:["CHECK"]},{name:"maker",isMut:!0,isSigner:!0},{name:"makerInputAccount",isMut:!0,isSigner:!1,docs:["CHECK, it is not important if it is sol input mint"]},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"inputMint",isMut:!1,isSigner:!1,isOptional:!0}],args:[]},{name:"cancelExpiredOrder",accounts:[{name:"order",isMut:!0,isSigner:!1},{name:"reserve",isMut:!0,isSigner:!1,docs:["CHECK"]},{name:"maker",isMut:!0,isSigner:!1},{name:"makerInputAccount",isMut:!0,isSigner:!1,docs:["CHECK, it is not important if it is sol input mint"]},{name:"systemProgram",isMut:!1,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"inputMint",isMut:!1,isSigner:!1,isOptional:!0}],args:[]},{name:"withdrawFee",accounts:[{name:"admin",isMut:!0,isSigner:!0},{name:"feeAuthority",isMut:!1,isSigner:!1,docs:["CHECK"]},{name:"programFeeAccount",isMut:!0,isSigner:!1},{name:"adminTokenAcocunt",isMut:!0,isSigner:!1},{name:"tokenProgram",isMut:!1,isSigner:!1},{name:"mint",isMut:!1,isSigner:!1}],args:[{name:"amount",type:"u64"}]},{name:"initFee",accounts:[{name:"keeper",isMut:!0,isSigner:!0},{name:"feeAuthority",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"makerFee",type:"u64"},{name:"makerStableFee",type:"u64"},{name:"takerFee",type:"u64"},{name:"takerStableFee",type:"u64"}]},{name:"updateFee",accounts:[{name:"keeper",isMut:!0,isSigner:!0},{name:"feeAuthority",isMut:!0,isSigner:!1}],args:[{name:"makerFee",type:"u64"},{name:"makerStableFee",type:"u64"},{name:"takerFee",type:"u64"},{name:"takerStableFee",type:"u64"}]}],accounts:[{name:"fee",type:{kind:"struct",fields:[{name:"makerFee",type:"u64"},{name:"makerStableFee",type:"u64"},{name:"takerFee",type:"u64"},{name:"takerStableFee",type:"u64"}]}},{name:"order",type:{kind:"struct",fields:[{name:"maker",type:"publicKey"},{name:"inputMint",type:"publicKey"},{name:"outputMint",type:"publicKey"},{name:"waiting",type:"bool"},{name:"oriMakingAmount",type:"u64"},{name:"oriTakingAmount",type:"u64"},{name:"makingAmount",type:"u64"},{name:"takingAmount",type:"u64"},{name:"makerInputAccount",type:"publicKey"},{name:"makerOutputAccount",type:"publicKey"},{name:"reserve",type:"publicKey"},{name:"borrowMakingAmount",type:"u64"},{name:"expiredAt",type:{option:"i64"}},{name:"base",type:"publicKey"},{name:"referral",type:{option:"publicKey"}}]}}],events:[{name:"TradeEvent",fields:[{name:"orderKey",type:"publicKey",index:!1},{name:"taker",type:"publicKey",index:!1},{name:"remainingInAmount",type:"u64",index:!1},{name:"remainingOutAmount",type:"u64",index:!1},{name:"inAmount",type:"u64",index:!1},{name:"outAmount",type:"u64",index:!1}]},{name:"CancelOrderEvent",fields:[{name:"orderKey",type:"publicKey",index:!1}]},{name:"CreateOrderEvent",fields:[{name:"orderKey",type:"publicKey",index:!1},{name:"maker",type:"publicKey",index:!1},{name:"inputMint",type:"publicKey",index:!1},{name:"outputMint",type:"publicKey",index:!1},{name:"inAmount",type:"u64",index:!1},{name:"outAmount",type:"u64",index:!1},{name:"expiredAt",type:{option:"i64"},index:!1}]}],errors:[{code:6e3,name:"InvalidMakingAmount"},{code:6001,name:"InvalidTakingAmount"},{code:6002,name:"InvalidMaxTakingAmount"},{code:6003,name:"InvalidCalculation"},{code:6004,name:"InvalidInputAccount"},{code:6005,name:"InvalidOutputAccount"},{code:6006,name:"InvalidPair"},{code:6007,name:"MissingReferral"},{code:6008,name:"OrderExpired"},{code:6009,name:"OrderNotExpired"},{code:6010,name:"InvalidKeeper"},{code:6011,name:"MathOverflow"},{code:6012,name:"ProgramMismatch"},{code:6013,name:"UnknownInstruction"},{code:6014,name:"MissingRepayInstructions"},{code:6015,name:"InvalidOrder"},{code:6016,name:"InvalidBorrowMakingAmount"}]},R=(e,n,t,...r)=>I(void 0,[e,n,t,...r],(function*(e,n,t,r=n,o=!0,c=a){let s;try{s=yield async function(e,n,t=!1,r=a,o=u){if(!t&&!i.PublicKey.isOnCurve(n.toBuffer()))throw new p;const[c]=await i.PublicKey.findProgramAddress([n.toBuffer(),r.toBuffer(),e.toBuffer()],o);return c}(e,n,o,c);if(!(yield t.getAccountInfo(s))){return[s,g(r,s,n,e,c)]}return[s,void 0]}catch(m){throw console.error("Error::getOrCreateATAInstruction",m),m}})),B={localnet:new i.PublicKey("APpKbNFPVs3tpkMsKCHJCdD1uKiTH57KYXj6RQnqY1Fu"),devnet:new i.PublicKey("A785JfFMTxGPvmij7dC5GvqLFujJuFTdytnPMQf4Txuw"),"mainnet-beta":new i.PublicKey("jupoNjAxXgZ4rjzxzPMP4oxduvQsQtZzyknqvzYNrNu")},z=new i.PublicKey("45ruCyfdRkWpRNGEqWzjCiXRHkZs8WXCLQ67Pnpye7Hp"),C=(0,P.K5)({links:[(0,P.N8)({url:"https://jup.ag/api/trpc"})],transformer:k.ZP}),E=class{constructor(e,n=null,t=null,i="mainnet-beta"){this.referralAccount=n,this.referralName=t,this.connection=e,this.referralProvider=new T(e);const a=new r.Y7(e,{},r.Y7.defaultOptions());this.program=new r.$r(O,B[i],a)}getFee(){return I(this,null,(function*(){let[e]=i.PublicKey.findProgramAddressSync([x.from("fee")],this.program.programId);return yield this.program.account.fee.fetch(e)}))}getOrder(e){return I(this,null,(function*(){return yield this.program.account.order.fetch(e)}))}getOrders(){return I(this,arguments,(function*(e=[]){return yield this.program.account.order.all(e)}))}getOrderPubkey(e){return i.PublicKey.findProgramAddressSync([x.from("order"),e.toBuffer()],B["mainnet-beta"])[0]}getOrderHistoryCount(e){return I(this,arguments,(function*({wallet:e}){return yield C.orderHistoryCount.query({wallet:e})}))}getOrderHistory(e){return I(this,arguments,(function*({wallet:e,lastCursor:n,take:t}){return yield C.orderHistory.query({wallet:e,cursor:n,take:t})}))}getTradeHistoryCount(e){return I(this,arguments,(function*({wallet:e}){return yield C.tradeHistoryCount.query({wallet:e})}))}getTradeHistory(e){return I(this,arguments,(function*({wallet:e,lastCursor:n,take:t}){return yield C.tradeHistory.query({wallet:e,cursor:n,take:t})}))}createOrder(e){return I(this,arguments,(function*({owner:e,inputMint:n,outputMint:t,outAmount:r,inAmount:a,base:o,expiredAt:u=null}){const s=this.getOrderPubkey(o),[m]=i.PublicKey.findProgramAddressSync([x.from("reserve"),s.toBuffer()],this.program.programId);let l=[];const p=yield this.connection.getAccountInfo(n),d=yield this.connection.getAccountInfo(t);let[[y,f],[g,h]]=yield Promise.all([R(n,e,this.connection,void 0,void 0,p.owner),R(t,e,this.connection,void 0,void 0,d.owner)]);n.equals(c)?y=g:f&&l.push(f),t.equals(c)?g=y:h&&l.push(h);let A=null;if(this.referralAccount){const e=this.getReferralAccountPubKey(),n=this.referralProvider.getReferralTokenAccountPubKey({mint:t,referralAccountPubKey:e});(yield this.connection.getAccountInfo(n))&&(A=n)}return{tx:yield this.program.methods.initializeOrder(a,r,u).accounts({maker:e,makerInputAccount:y,inputMint:n,makerOutputAccount:g,outputMint:t,order:s,reserve:m,referral:A,base:o,tokenProgram:p.owner}).preInstructions(l).transaction(),orderPubKey:s}}))}cancelOrderInstruction(e){return I(this,arguments,(function*({owner:e,orderPubKey:n}){const t=yield this.program.account.order.fetch(n);let r=[];const i=yield this.connection.getAccountInfo(t.inputMint),[a,o]=yield R(t.inputMint,e,this.connection,void 0,void 0,i.owner);o&&!t.inputMint.equals(c)&&r.push(o);const u=yield this.program.methods.cancelOrder().accounts({maker:e,makerInputAccount:a,reserve:t.reserve,order:n,tokenProgram:i.owner,inputMint:t.inputMint}).instruction();return[...r,u]}))}cancelOrder(e){return I(this,arguments,(function*({owner:e,orderPubKey:n}){const t=yield this.cancelOrderInstruction({owner:e,orderPubKey:n});return(new i.Transaction).add(...t)}))}batchCancelOrder(e){return I(this,arguments,(function*({owner:e,ordersPubKey:n}){if(n.length>10)throw"ordersPubKey lenght exceed 10";const t=yield Promise.all(n.map((n=>this.cancelOrderInstruction({owner:e,orderPubKey:n}))));return(new i.Transaction).add(...t.flat())}))}cancelExpiredOrderInstruction(e){return I(this,arguments,(function*({orderPubKey:e}){const n=yield this.program.account.order.fetch(e),t=yield this.connection.getAccountInfo(n.inputMint),[r,i]=yield R(n.inputMint,n.maker,this.connection,void 0,void 0,t.owner);return i&&!n.inputMint.equals(c)?null:yield this.program.methods.cancelExpiredOrder().accounts({order:e,reserve:n.reserve,maker:n.maker,makerInputAccount:r,tokenProgram:t.owner,inputMint:n.inputMint}).instruction()}))}cancelExpiredOrder(e){return I(this,arguments,(function*({orderPubKey:e}){const n=yield this.cancelExpiredOrderInstruction({orderPubKey:e});return n?(new i.Transaction).add(n):null}))}batchCancelExpiredOrder(e){return I(this,arguments,(function*({ordersPubKey:e}){if(e.length>10)throw"ordersPubKey lenght exceed 10";const n=(yield Promise.all(e.map((e=>this.cancelExpiredOrderInstruction({orderPubKey:e}))))).filter(Boolean);return n.length>0?(new i.Transaction).add(...n):null}))}fillOrder(e){return I(this,arguments,(function*({owner:e,orderAccount:n,amount:t,expectedOutAmount:r}){const{account:a,publicKey:o}=n;let u=[],[s]=i.PublicKey.findProgramAddressSync([x.from("fee")],this.program.programId),m=a.makerOutputAccount,[[l,p],[d,y],[f,g],[h,A]]=yield Promise.all([R(a.outputMint,a.maker,this.connection,e),R(a.outputMint,e,this.connection),R(a.inputMint,e,this.connection),R(a.outputMint,s,this.connection,e)]);a.inputMint.toString()===c.toString()?f=e:g&&u.push(g),a.outputMint.toString()===c.toString()?(d=e,m=a.maker):(p&&u.push(p),y&&u.push(y)),A&&u.push(A);return yield this.program.methods.fillOrder(t,r).accounts({order:o,reserve:a.reserve,maker:a.maker,taker:e,makerOutputAccount:m,takerInputAccount:d,takerOutputAccount:f,programFeeAccount:h,referral:a.referral,feeAuthority:s}).preInstructions(u).transaction()}))}createReferralAccount(e){return I(this,null,(function*(){if(!this.referralAccount)throw"Referral is missing";if(!this.referralName)throw"Name is missing";return yield this.referralProvider.initializeReferralAccountWithName({projectPubKey:z,partnerPubKey:this.referralAccount,name:this.referralName,payerPubKey:e})}))}createReferralTokenAccount(e,n){return I(this,null,(function*(){if(!this.referralAccount)throw"Referral is missing";const t=this.getReferralAccountPubKey();if(!(yield this.referralProvider.getReferralAccount(t)))throw"Referral account already exists";return this.referralProvider.initializeReferralTokenAccount({mint:e,payerPubKey:n,referralAccountPubKey:t})}))}claimReferral(e,n){return I(this,null,(function*(){if(!this.referralAccount)throw"Referral is missing";const t=this.getReferralAccountPubKey();if(!(yield this.referralProvider.getReferralAccount(t)))throw"Referral account already exists";return yield this.referralProvider.claim({mint:e,referralAccountPubKey:t,payerPubKey:n})}))}getReferralAccountPubKey(){if(this.referralName)return this.referralProvider.getReferralAccountWithNamePubKey({projectPubKey:z,name:this.referralName});{const[e]=i.PublicKey.findProgramAddressSync([x.from("referral"),z.toBuffer(),this.referralAccount.toBuffer()],w);return e}}},F=e=>({memcmp:{offset:8,bytes:e.toBase58()}})}}]);
//# sourceMappingURL=3020-4025202d4491e08c.js.map